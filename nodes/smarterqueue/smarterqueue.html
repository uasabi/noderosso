<script type="text/javascript">
  RED.nodes.registerType('smarterqueue', {
    category: 'function',
    color: '#a6bbcf',
    defaults: {
      name: { value: '' },
      categories: { value: '' },
      failsafe: { value: '' },
    },
    inputs: 1,
    outputs: 1,
    icon: 'file.png',
    label: function () {
      return this.name || 'smarterqueue'
    },
    oneditprepare: function () {
      $('#schedule')
        .css('min-height', '150px')
        .css('min-width', '450px')
        .editableList({
          header: $('<div>').text('Schedule'),
          addButton: 'Add a slot',
          removable: true,
          addItem: function (row, index, data) {
            $(row).append($('<input type="text" name="slot[]"/>').val(isString(data) ? data : ''))
            function isString(value) {
              return {}.toString.call(value) === '[object String]'
            }
          },
        })
      const slots = ($('#node-input-slots').val() + '')
        .split('|')
        .filter((it) => it.length > 0)
        .sort((a, b) => {
          return getValue(a) - getValue(b)

          function getValue(date) {
            return date.getDay() * 24 * 60 + date.getHours() * 60 + date.getMinutes()
          }
        })
      $('#schedule').editableList('addItems', slots)
    },
    oneditsave: function () {
      const slots = $('[name="slot[]"]')
        .map((index, element) => {
          return $(element).val()
        })
        .get()
        .filter((it) => !!it && (it + '').trim().length > 0)
        .map((it) => it.trim())
      $('#node-input-slots').val(slots.join('|'))
    },
  })
</script>

<script type="text/html" data-template-name="smarterqueue">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <input type="hidden" id="node-input-slots">
    <ul id="schedule"></ul>
  </div>
  <div class="form-row">
    <label for="node-input-failsafe"><i class="icon-tag"></i> Max emit</label>
    <input type="text" id="node-input-failsafe" placeholder="failsafe">
  </div>
</script>

<script type="text/html" data-help-name="smarterqueue">
  <p>Schedule tweets</p>
</script>